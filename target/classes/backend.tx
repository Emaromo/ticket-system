ğŸ§  1. Â¿QuÃ© hace tu app?
Tu aplicaciÃ³n es un sistema de tickets de soporte tÃ©cnico con:

Registro y login de usuarios

Control de acceso por rol (ADMIN, CLIENTE)

CreaciÃ³n y gestiÃ³n de tickets

ProtecciÃ³n con JWT

Interfaz moderna en React (paneles separados por rol)

ğŸ§± 2. AnÃ¡lisis por capas
ğŸ“¦ ENTIDADES (@Entity) â†’ se guardan en base de datos
âœ… UserEntity.java
QuÃ© es:
Representa a un usuario en la base de datos.

Campos:

id, nombre, email, password, rol

Para quÃ© sirve:
Este objeto se guarda en la tabla users. Contiene la info necesaria para autenticaciÃ³n y autorizaciÃ³n.

Se usa en:

Login

Registro

Seguridad (para extraer email y rol)

EncriptaciÃ³n de contraseÃ±as

âœ… TicketModel.java
QuÃ© es:
Representa un ticket de reparaciÃ³n o soporte.

Campos:

id, clienteEmail, descripcionProblema, estado, solucion, fechaCreacion, precio, prioridad

Para quÃ© sirve:
Se guarda en la base de datos. Admins pueden crear/modificar, clientes solo ver el suyo.

ğŸ—ƒï¸ 3. REPOSITORIOS â†’ acceso a la base de datos
âœ… UserRepository.java
Extiende: JpaRepository<UserEntity, Long>

QuÃ© hace:
Permite buscar, guardar y verificar usuarios en la tabla users.

MÃ©todos clave:

findByEmail(String email) â†’ lo usa el login

âœ… TicketRepository.java
Extiende: JpaRepository<TicketModel, Long>

QuÃ© hace:
Accede a la tabla de tickets.

MÃ©todos clave personalizados:

findByClienteEmail(String email) â†’ para obtener el ticket del cliente

ğŸ§  4. SERVICIOS â†’ lÃ³gica de negocio
âœ… UserService.java
QuÃ© hace:
Controla el registro de usuarios.

Acciones clave:

Recibe el registro desde el controller

Encripta la contraseÃ±a

Guarda el usuario en la base de datos

âœ… TicketService.java
QuÃ© hace:
LÃ³gica para manejar tickets (crear, editar, borrar).

Funciones clave:

crearTicket(...)

getTicketPorEmail(...)

actualizarTicket(id, ticketActualizado)

eliminarTicket(id)

listarTodos()

ğŸ§© 5. CONTROLADORES REST â†’ entrada/salida HTTP
âœ… UserController.java
Rutas:

POST /users â†’ registro

POST /users/login â†’ login

QuÃ© hace:

Recibe credenciales

Autentica usuario

Devuelve token JWT con email + rol

âœ… TicketController.java
Rutas protegidas:

GET /tickets/cliente/{email} â†’ cliente ve su ticket

GET /tickets â†’ lista completa (admin)

POST /tickets â†’ crear nuevo (admin)

PUT /tickets/{id} â†’ actualizar (admin)

DELETE /tickets/{id} â†’ borrar (admin)

ProtecciÃ³n por rol:

Se configura con Spring Security para que:

ROLE_ADMIN accede a todo

ROLE_CLIENTE accede solo a su ticket por email

ğŸ“¤ 6. DTO â†’ respuesta para frontend
âœ… UserRest.java
QuÃ© es:
Un DTO (Data Transfer Object). Se usa para no devolver toda la entidad UserEntity al frontend.

Contiene:

id, nombre, email, rol

Â¿Por quÃ© no se usa directamente UserEntity?

Por seguridad (no se devuelve la contraseÃ±a)

Por orden (devuelve solo lo necesario)

ğŸ” 7. SEGURIDAD: filtros y JWT
âœ… JWTAuthorizationFilter.java
QuÃ© hace:

Intercepta cada peticiÃ³n

Valida el token JWT

Extrae email y rol

Crea Authentication y lo inyecta al sistema de Spring

âœ… JWTUtil.java
QuÃ© hace:

Genera el JWT (generateToken(email, rol))

Verifica validez (isTokenValid)

Extrae datos (getEmail, getRole)

âœ… SecurityConfig.java
QuÃ© hace:

Configura las reglas:

/users y /users/login â†’ pÃºblicos

Resto â†’ protegidos por JWT y rol

Agrega el filtro JWTAuthorizationFilter

Habilita CORS para React

Define polÃ­tica stateless (sin sesiones)

âœ… SecurityConstants.java
QuÃ© hace:

Define constantes comunes:

Header: Authorization

Prefijo: Bearer

Clave secreta (base64)

Tiempo de expiraciÃ³n

ğŸ”„ 8. FLUJO COMPLETO DE UNA PETICIÃ“N
ğŸ” 1. Login:
Usuario se loguea â†’ POST /users/login

Se verifica la contraseÃ±a

Se genera un token JWT con email y rol

Se devuelve al frontend

ğŸ§¾ 2. Peticiones protegidas:
El frontend incluye el token en cada request:

http
Copiar
Editar
Authorization: Bearer <token>
El filtro JWTAuthorizationFilter lo intercepta, valida y autoriza

SegÃºn el rol, Spring permite o deniega el acceso al controlador

ğŸ–¼ï¸ 9. DIAGRAMA CONCEPTUAL (lÃ³gico)
less
Copiar
Editar
React frontend
     |
     â†“
Login/Register â†’ [UserController] â†’ [UserService] â†’ [UserRepository] â†’ BD
     |
     â†“
JWT token â†-------------- [JWTUtil]
     |
     â†“
(Con token) Request â†’ [JWTFilter] â†’ Spring Security â†’ [TicketController]
                                          |
                       [TicketService] â†â†’ [TicketRepository] â†â†’ BD
âœ… 10. RelaciÃ³n de cada archivo y para quÃ© sirve
Componente	Tipo	Para quÃ© sirve	RelaciÃ³n principal
UserEntity	@Entity	Usuario guardado en BD	Seguridad, Login
TicketModel	@Entity	Ticket en la BD	Admin, cliente
UserRepository	DAO	Acceso a usuarios	Login, registro
TicketRepository	DAO	Acceso a tickets	Listar, buscar por email
UserService	Service	LÃ³gica de usuarios	Registro
TicketService	Service	LÃ³gica de tickets	Admin Dashboard
UserController	Controller	Login y registro	JWT, frontend
TicketController	Controller	CRUD de tickets	Protegido por rol
UserRest	DTO	Respuesta sin contraseÃ±a	Seguridad de respuesta
JWTUtil	Utils	Generar y validar token	Seguridad
JWTFilter	Filtro	Intercepta peticiones	Seguridad
SecurityConfig	Config	Reglas de acceso	Seguridad JWT
SecurityConstants	Constantes	Secretos y headers	Seguridad JWT

1. Flujo completo: login y uso de token
[Usuario ingresa email y password]
        |
        v
 [POST /users/login] (UserRestController)
        |
        v
 [LoginService -> valida -> genera JWT]
        |
        v
   <- JWT con rol + email
        |
        v
[Frontend guarda JWT en localStorage]
        |
        v
 [Cada request incluye token en Header]
        |
        v
 [JWTAuthorizationFilter valida]
        |
        v
 [Spring Security deja pasar si es vÃ¡lido]
        |
        v
[Se accede al controlador correspondiente]
-------------------------------------------------
2. Diagrama de capas (backend)
ontroladores (REST)
    |
Servicios (Service)
    |
Repositorios (JPA Repository)
    |
Base de datos (H2 / MySQL)
-----------------------------------------------
3. Seguridad

+-------------------------------+
|         Usuario               |
+-------------------------------+
             |
             | (Login)
             v
+-------------------------------+
|       LoginService + JWTUtil |
+-------------------------------+
             |
             v
[Token JWT generado con rol + email]
             |
             v
[Frontend lo guarda y lo envÃ­a en requests]
             |
             v
+-------------------------------+
|    JWTAuthorizationFilter    |
+-------------------------------+
             |
             v
 [Token vÃ¡lido? -> Acceso OK]
             |
             v
+-------------------------------+
|      Controladores REST      |
+-------------------------------+